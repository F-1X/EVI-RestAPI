
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>docs: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">advertisement-rest-api-http-service/cmd/docs/docs.go (0.0%)</option>
				
				<option value="file1">advertisement-rest-api-http-service/cmd/main.go (0.0%)</option>
				
				<option value="file2">advertisement-rest-api-http-service/internal/handler/api/v1/ad_handler.go (45.8%)</option>
				
				<option value="file3">advertisement-rest-api-http-service/internal/handler/mocks/Handler.go (0.0%)</option>
				
				<option value="file4">advertisement-rest-api-http-service/internal/repository/firebase/ad_repository.go (0.0%)</option>
				
				<option value="file5">advertisement-rest-api-http-service/internal/repository/mocks/AdRepository.go (0.0%)</option>
				
				<option value="file6">advertisement-rest-api-http-service/internal/router/router.go (0.0%)</option>
				
				<option value="file7">advertisement-rest-api-http-service/internal/service/ad_service.go (0.0%)</option>
				
				<option value="file8">advertisement-rest-api-http-service/internal/service/mocks/AdServicer.go (22.4%)</option>
				
				<option value="file9">advertisement-rest-api-http-service/pkg/firebase/firebase.go (0.0%)</option>
				
				<option value="file10">advertisement-rest-api-http-service/pkg/logger/logger.go (0.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">// Package docs Code generated by swaggo/swag. DO NOT EDIT
package docs

import "github.com/swaggo/swag"

const docTemplate = `{
    "schemes": {{ marshal .Schemes }},
    "swagger": "2.0",
    "info": {
        "description": "{{escape .Description}}",
        "title": "{{.Title}}",
        "termsOfService": "http://swagger.io/terms/",
        "contact": {
            "name": "API Support",
            "url": "http://www.swagger.io/support",
            "email": "support@swagger.io"
        },
        "license": {
            "name": "Apache 2.0",
            "url": "http://www.apache.org/licenses/LICENSE-2.0.html"
        },
        "version": "{{.Version}}"
    },
    "host": "{{.Host}}",
    "basePath": "{{.BasePath}}",
    "paths": {
        "/ad": {
            "post": {
                "description": "Create a new advertisement",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Advertisements"
                ],
                "summary": "Create Ad",
                "parameters": [
                    {
                        "description": "Data of the new advertisement",
                        "name": "ad",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/model.Ad"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "{\"id\": \"ffZ0Wo9KIh29G24iNE1t\"}",
                        "schema": {
                            "type": "object"
                        }
                    },
                    "400": {
                        "description": "{\"error\": \"Bad request\"}",
                        "schema": {
                            "type": "object"
                        }
                    },
                    "500": {
                        "description": "{\"error\": \"Internal server error\"}",
                        "schema": {
                            "type": "object"
                        }
                    }
                }
            }
        },
        "/ad/{id}": {
            "get": {
                "description": "Retrieve an advertisement by ID",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Example"
                ],
                "summary": "Get Ad",
                "parameters": [
                    {
                        "type": "string",
                        "description": "ID of the advertisement to retrieve",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "{\"id\": \"ffZ0Wo9KIh29G24iNE1t\"}",
                        "schema": {
                            "type": "object"
                        }
                    },
                    "500": {
                        "description": "{\"error\": \"Internal server error\"}",
                        "schema": {
                            "type": "object"
                        }
                    }
                }
            }
        },
        "/ads": {
            "get": {
                "description": "Retrieve a list of advertisements",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Advertisements"
                ],
                "summary": "Get Ads",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Page number",
                        "name": "page",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Sorting field (price, createdAt)",
                        "name": "sort",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Sorting order (asc, desc)",
                        "name": "order",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "array",
                            "items": {
                                "type": "object"
                            }
                        }
                    },
                    "400": {
                        "description": "{\"error\": \"Bad request\"}",
                        "schema": {
                            "type": "object"
                        }
                    },
                    "500": {
                        "description": "{\"error\": \"Internal server error\"}",
                        "schema": {
                            "type": "object"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "model.Ad": {
            "type": "object",
            "properties": {
                "description": {
                    "type": "string"
                },
                "name": {
                    "type": "string"
                },
                "price": {
                    "type": "number"
                }
            }
        }
    }
}`

// SwaggerInfo holds exported Swagger Info so clients can modify it
var SwaggerInfo = &amp;swag.Spec{
        Version:          "1.0",
        Host:             "localhost:8888",
        BasePath:         "/api/v1",
        Schemes:          []string{},
        Title:            "Swagger Example API",
        Description:      "This is a sample server celler server.",
        InfoInstanceName: "swagger",
        SwaggerTemplate:  docTemplate,
        LeftDelim:        "{{",
        RightDelim:       "}}",
}

func init() <span class="cov0" title="0">{
        swag.Register(SwaggerInfo.InstanceName(), SwaggerInfo)
}</span>
</pre>
		
		<pre class="file" id="file1" style="display: none">package main

import (
        firebaseRepository "advertisement-rest-api-http-service/internal/repository/firebase" // docs is generated by Swag CLI, you have to import it.
        "advertisement-rest-api-http-service/internal/router"
        "advertisement-rest-api-http-service/internal/service"
        database "advertisement-rest-api-http-service/pkg/firebase"
        "context"
        "log"
)

//        @title                        Swagger Example API
//        @version                1.0
//        @description        This is a sample server celler server.
//        @termsOfService        http://swagger.io/terms/

//        @contact.name        API Support
//        @contact.url        http://www.swagger.io/support
//        @contact.email        support@swagger.io

//        @license.name        Apache 2.0
//        @license.url        http://www.apache.org/licenses/LICENSE-2.0.html

//        @host                localhost:8888
//        @BasePath        /api/v1

func main() <span class="cov0" title="0">{

        ctx := context.Background()

        // init database
        firestoreClient, err := database.InitFirestoreClient(ctx, "evi-safety-technology-testtask-775f99dde1b0.json")
        if err != nil </span><span class="cov0" title="0">{
                log.Fatal("err: firestoreClient", err)
        }</span>
        <span class="cov0" title="0">defer firestoreClient.Close(ctx)

        // init repository
        repo := firebaseRepository.NewAdRepository(firestoreClient)

        // init service
        service := service.NewAdService(repo)

        // init router
        router := router.NewGinRouter()

        router.AddHandlers(service)

        router.Run("8888")</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package v1

import (
        "advertisement-rest-api-http-service/internal/handler"
        "advertisement-rest-api-http-service/internal/model"
        "advertisement-rest-api-http-service/internal/service"
        "log"
        "net/http"
        "strconv"
        "time"

        "github.com/gin-gonic/gin"
)

type adHandler struct {
        service service.AdServicer
}

func NewAdHandler(service service.AdServicer) handler.Handler <span class="cov8" title="1">{
        return &amp;adHandler{service: service}
}</span>

// GetAd retrieves an advertisement by ID.
//
//        @Summary                Get Ad
//        @Description        Retrieve an advertisement by ID
//        @Tags                        Advertisements
//        @Accept                        json
//        @Produce                json
//        @Param                        id        path                string        true        "ID of the advertisement to retrieve"
//        @Success                200        {object}        object        "{"id": "ffZ0Wo9KIh29G24iNE1t"}"
//        @Failure                500        {object}        object        "{"error": "Internal        server        error"}"
//        @Router                        /ad/{id} [get]
func (h *adHandler) GetAd(c *gin.Context) <span class="cov0" title="0">{
        id := c.Param("id")

        if _, ok := c.Request.URL.Query()["fields"]; ok </span><span class="cov0" title="0">{
                ad, err := h.service.GetAdByID(c.Request.Context(), id, true)
                if err != nil </span><span class="cov0" title="0">{
                        c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                        return
                }</span>
                <span class="cov0" title="0">c.JSON(http.StatusOK, ad)
                return</span>
        }

        <span class="cov0" title="0">ad, err := h.service.GetAdByID(c.Request.Context(), id, false)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusOK, ad)</span>
}

// CreateAd creates a new advertisement.
//
//        @Summary                Create Ad
//        @Description        Create a new advertisement
//        @Tags                        Advertisements
//        @Accept                        json
//        @Produce                json
//        @Param                        ad        body                model.Ad        true        "Data of the new advertisement"
//        @Success                201        {object}        object                "{"id": "ffZ0Wo9KIh29G24iNE1t"}"
//        @Failure                400        {object}        object                "{"error": "Bad                        request"}"
//        @Failure                500        {object}        object                "{"error": "Internal        server        error"}"
//        @Router                        /ad [post]
func (h *adHandler) CreateAd(c *gin.Context) <span class="cov0" title="0">{

        var ad model.Ad
        if err := c.ShouldBindJSON(&amp;ad); err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
                return
        }</span>
        <span class="cov0" title="0">location, err := time.LoadLocation("Europe/Amsterdam")
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov0" title="0">ad.CreatedAt = time.Now().In(location)
        ad.UpdatedAt = time.Now().In(location)

        log.Println(ad)
        id, err := h.service.CreateAd(c.Request.Context(), &amp;ad)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusCreated, gin.H{"id": id})</span>
}

// GetAds retrieves a list of advertisements.
//
//        @Summary                Get Ads
//        @Description        Retrieve a list of advertisements
//        @Tags                        Advertisements
//        @Produce                json
//        @Param                        page        query                int                false        "Page number"
//        @Param                        sort        query                string        false        "Sorting field (price, createdAt, updatedAt)"
//        @Param                        order        query                string        false        "Sorting order (asc, desc)"
//        @Success                200                {array}                object
//        @Failure                400                {object}        object        "{"error": "Bad                        request"}"
//        @Failure                500                {object}        object        "{"error": "Internal        server        error"}"
//        @Router                        /ads [get]
func (h *adHandler) GetAds(c *gin.Context) <span class="cov8" title="1">{
        page := 1
        order := "desc"
        sort := "price"
        var err error
        if _, ok := c.Request.URL.Query()["page"]; ok </span><span class="cov8" title="1">{
                page, err = strconv.Atoi(c.Query("page"))
                if err != nil </span><span class="cov8" title="1">{
                        c.JSON(http.StatusBadRequest, gin.H{"error": "invalid page parameter"})
                        return
                }</span>
                <span class="cov8" title="1">if !validatePage(page) </span><span class="cov8" title="1">{
                        c.JSON(http.StatusBadRequest, gin.H{"error": "invalid page parameter"})
                        return
                }</span>
        }

        <span class="cov8" title="1">if orderStr, ok := c.Request.URL.Query()["order"]; ok </span><span class="cov8" title="1">{
                if len(orderStr) &gt; 0 &amp;&amp; (orderStr[0] != "asc" &amp;&amp; orderStr[0] != "desc") </span><span class="cov8" title="1">{
                        c.JSON(http.StatusBadRequest, gin.H{"error": "invalid order parameter"})
                        return
                }</span>
                <span class="cov8" title="1">order = orderStr[0]</span>
        }

        <span class="cov8" title="1">if sortStr, ok := c.Request.URL.Query()["sort"]; ok </span><span class="cov8" title="1">{
                if len(sortStr) &gt; 0 &amp;&amp; (sortStr[0] != "price" &amp;&amp; sortStr[0] != "createdAt" &amp;&amp; sortStr[0] != "updatedAt") </span><span class="cov0" title="0">{
                        c.JSON(http.StatusBadRequest, gin.H{"error": "invalid sort parameter"})
                        return
                }</span>
                <span class="cov8" title="1">sort = sortStr[0]</span>
        }

        <span class="cov8" title="1">ads, err := h.service.GetAds(c.Request.Context(), page, sort, order)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
                return
        }</span>

        <span class="cov8" title="1">c.JSON(http.StatusOK, ads)</span>
}

// better to place in validate package and test it inplace
func validatePage(page int) bool <span class="cov8" title="1">{
        if page &lt; 0 </span><span class="cov8" title="1">{
                return false
        }</span>

        <span class="cov8" title="1">return true</span>
}
</pre>
		
		<pre class="file" id="file3" style="display: none">// Code generated by mockery v2.42.2. DO NOT EDIT.

package mocks

import (
        gin "github.com/gin-gonic/gin"

        mock "github.com/stretchr/testify/mock"
)

// Handler is an autogenerated mock type for the Handler type
type Handler struct {
        mock.Mock
}

// CreateAd provides a mock function with given fields: c
func (_m *Handler) CreateAd(c *gin.Context) <span class="cov0" title="0">{
        _m.Called(c)
}</span>

// GetAd provides a mock function with given fields: c
func (_m *Handler) GetAd(c *gin.Context) <span class="cov0" title="0">{
        _m.Called(c)
}</span>

// GetAds provides a mock function with given fields: c
func (_m *Handler) GetAds(c *gin.Context) <span class="cov0" title="0">{
        _m.Called(c)
}</span>

// NewHandler creates a new instance of Handler. It also registers a testing interface on the mock and a cleanup function to assert the mocks expectations.
// The first argument is typically a *testing.T value.
func NewHandler(t interface {
        mock.TestingT
        Cleanup(func())
}) *Handler <span class="cov0" title="0">{
        mock := &amp;Handler{}
        mock.Mock.Test(t)

        t.Cleanup(func() </span><span class="cov0" title="0">{ mock.AssertExpectations(t) }</span>)

        <span class="cov0" title="0">return mock</span>
}
</pre>
		
		<pre class="file" id="file4" style="display: none">package firestoreRepository

import (
        "advertisement-rest-api-http-service/internal/model"
        "advertisement-rest-api-http-service/internal/repository"
        database "advertisement-rest-api-http-service/pkg/firebase"
        "context"
        "log"

        "cloud.google.com/go/firestore"
        "google.golang.org/api/iterator"
)

type adRepository struct {
        client database.DB
}

func NewAdRepository(client database.DB) repository.AdRepository <span class="cov0" title="0">{

        return &amp;adRepository{client: client}
}</span>

func (r *adRepository) GetAds(ctx context.Context, page int, sort string, order string) ([]*model.Ad, error) <span class="cov0" title="0">{
        var ads []*model.Ad
        var query firestore.Query

        if sort == "" </span><span class="cov0" title="0">{
                sort = "created_at"
        }</span>

        <span class="cov0" title="0">orderBy := firestore.Desc
        if order == "asd" </span><span class="cov0" title="0">{
                orderBy = firestore.Asc
        }</span>

        <span class="cov0" title="0">query = r.client.Collection("ads").OrderBy(sort, orderBy).Offset((page - 1) * 10).Limit(10)



        iter := query.Documents(ctx)
        defer iter.Stop()

        for </span><span class="cov0" title="0">{
                doc, err := iter.Next()
                log.Println("doc", doc)
                if err == iterator.Done </span><span class="cov0" title="0">{
                        break</span>
                }
                <span class="cov0" title="0">if err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>

                <span class="cov0" title="0">var ad model.Ad
                if err := doc.DataTo(&amp;ad); err != nil </span><span class="cov0" title="0">{
                        return nil, err
                }</span>

                <span class="cov0" title="0">ads = append(ads, &amp;ad)</span>
        }
        <span class="cov0" title="0">log.Println(ads)

        return ads, nil</span>
}

func (r *adRepository) GetAdByID(ctx context.Context, id string, fields bool) (*model.Ad, error) <span class="cov0" title="0">{

        doc, err := r.client.Collection("ads").Doc(id).Get(ctx)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">var ad model.Ad

        err = doc.DataTo(&amp;ad)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">if !fields </span><span class="cov0" title="0">{
                ad.Description = ""
        }</span>

        <span class="cov0" title="0">return &amp;ad, nil</span>
}

func (r *adRepository) CreateAd(ctx context.Context, ad *model.Ad) (string, error) <span class="cov0" title="0">{

        ref, _, err := r.client.Collection("ads").Add(ctx, ad)
        if err != nil </span><span class="cov0" title="0">{
                return "", err
        }</span>

        <span class="cov0" title="0">return ref.ID, nil</span>
}
</pre>
		
		<pre class="file" id="file5" style="display: none">// Code generated by mockery v2.42.2. DO NOT EDIT.

package mocks

import (
        model "advertisement-rest-api-http-service/internal/model"
        context "context"

        mock "github.com/stretchr/testify/mock"
)

// AdRepository is an autogenerated mock type for the AdRepository type
type AdRepository struct {
        mock.Mock
}

// CreateAd provides a mock function with given fields: ctx, ad
func (_m *AdRepository) CreateAd(ctx context.Context, ad *model.Ad) (string, error) <span class="cov0" title="0">{
        ret := _m.Called(ctx, ad)

        if len(ret) == 0 </span><span class="cov0" title="0">{
                panic("no return value specified for CreateAd")</span>
        }

        <span class="cov0" title="0">var r0 string
        var r1 error
        if rf, ok := ret.Get(0).(func(context.Context, *model.Ad) (string, error)); ok </span><span class="cov0" title="0">{
                return rf(ctx, ad)
        }</span>
        <span class="cov0" title="0">if rf, ok := ret.Get(0).(func(context.Context, *model.Ad) string); ok </span><span class="cov0" title="0">{
                r0 = rf(ctx, ad)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Get(0).(string)
        }</span>

        <span class="cov0" title="0">if rf, ok := ret.Get(1).(func(context.Context, *model.Ad) error); ok </span><span class="cov0" title="0">{
                r1 = rf(ctx, ad)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// GetAdByID provides a mock function with given fields: ctx, id, fields
func (_m *AdRepository) GetAdByID(ctx context.Context, id string, fields bool) (*model.Ad, error) <span class="cov0" title="0">{
        ret := _m.Called(ctx, id, fields)

        if len(ret) == 0 </span><span class="cov0" title="0">{
                panic("no return value specified for GetAdByID")</span>
        }

        <span class="cov0" title="0">var r0 *model.Ad
        var r1 error
        if rf, ok := ret.Get(0).(func(context.Context, string, bool) (*model.Ad, error)); ok </span><span class="cov0" title="0">{
                return rf(ctx, id, fields)
        }</span>
        <span class="cov0" title="0">if rf, ok := ret.Get(0).(func(context.Context, string, bool) *model.Ad); ok </span><span class="cov0" title="0">{
                r0 = rf(ctx, id, fields)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*model.Ad)
                }</span>
        }

        <span class="cov0" title="0">if rf, ok := ret.Get(1).(func(context.Context, string, bool) error); ok </span><span class="cov0" title="0">{
                r1 = rf(ctx, id, fields)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// GetAds provides a mock function with given fields: ctx, page, sort, order
func (_m *AdRepository) GetAds(ctx context.Context, page int, sort string, order string) ([]*model.Ad, error) <span class="cov0" title="0">{
        ret := _m.Called(ctx, page, sort, order)

        if len(ret) == 0 </span><span class="cov0" title="0">{
                panic("no return value specified for GetAds")</span>
        }

        <span class="cov0" title="0">var r0 []*model.Ad
        var r1 error
        if rf, ok := ret.Get(0).(func(context.Context, int, string, string) ([]*model.Ad, error)); ok </span><span class="cov0" title="0">{
                return rf(ctx, page, sort, order)
        }</span>
        <span class="cov0" title="0">if rf, ok := ret.Get(0).(func(context.Context, int, string, string) []*model.Ad); ok </span><span class="cov0" title="0">{
                r0 = rf(ctx, page, sort, order)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).([]*model.Ad)
                }</span>
        }

        <span class="cov0" title="0">if rf, ok := ret.Get(1).(func(context.Context, int, string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(ctx, page, sort, order)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// NewAdRepository creates a new instance of AdRepository. It also registers a testing interface on the mock and a cleanup function to assert the mocks expectations.
// The first argument is typically a *testing.T value.
func NewAdRepository(t interface {
        mock.TestingT
        Cleanup(func())
}) *AdRepository <span class="cov0" title="0">{
        mock := &amp;AdRepository{}
        mock.Mock.Test(t)

        t.Cleanup(func() </span><span class="cov0" title="0">{ mock.AssertExpectations(t) }</span>)

        <span class="cov0" title="0">return mock</span>
}
</pre>
		
		<pre class="file" id="file6" style="display: none">package router

import (
        docs "advertisement-rest-api-http-service/cmd/docs"
        v1 "advertisement-rest-api-http-service/internal/handler/api/v1"
        "advertisement-rest-api-http-service/internal/service"
        "context"
        "log"
        "net/http"
        "os"
        "os/signal"
        "syscall"
        "time"

        "github.com/gin-gonic/gin"
        swaggerFiles "github.com/swaggo/files"

        ginSwagger "github.com/swaggo/gin-swagger"
)

// gin-swagger middleware
// swagger embed files
type GinRouter struct {
        engine *gin.Engine
        server *http.Server
        quit   chan os.Signal
}

func NewGinRouter() *GinRouter <span class="cov0" title="0">{

        return &amp;GinRouter{
                engine: gin.Default(),
                server: &amp;http.Server{},
                quit:   make(chan os.Signal, 1),
        }
}</span>

func (r *GinRouter) Run(port string) <span class="cov0" title="0">{
        r.server.Handler = r.engine
        r.server.Addr = ":" + port

        signal.Notify(r.quit, syscall.SIGINT, syscall.SIGTERM)

        go func() </span><span class="cov0" title="0">{
                if err := r.server.ListenAndServe(); err != nil &amp;&amp; err != http.ErrServerClosed </span><span class="cov0" title="0">{
                        log.Fatalf("Error starting server: %s\n", err)
                }</span>
        }()

        <span class="cov0" title="0">&lt;-r.quit

        log.Println("Shutting down server gracefully...")

        ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
        defer cancel()

        if err := r.server.Shutdown(ctx); err != nil </span><span class="cov0" title="0">{
                log.Fatalf("Error shutting down server: %s\n", err)
        }</span>

        <span class="cov0" title="0">log.Println("Server stopped gracefully")</span>
}

func (r *GinRouter) Shutdown() <span class="cov0" title="0">{
        r.quit &lt;- syscall.SIGTERM
}</span>

func (r *GinRouter) AddHandlers(service service.AdServicer) <span class="cov0" title="0">{

        docs.SwaggerInfo.BasePath = "/api/v1"
        v1 := v1.NewAdHandler(service)
        apiv1 := r.engine.Group("/api/v1")
        </span><span class="cov0" title="0">{
                apiv1.GET("/ads", v1.GetAds)
                apiv1.GET("/ad/:id", v1.GetAd)
                apiv1.POST("/ad", v1.CreateAd)
        }</span>
        <span class="cov0" title="0">r.engine.GET("/swagger/*any", ginSwagger.WrapHandler(swaggerFiles.Handler))</span>
        
}
</pre>
		
		<pre class="file" id="file7" style="display: none">package service

import (
        "advertisement-rest-api-http-service/internal/model"
        "advertisement-rest-api-http-service/internal/repository"
        "context"
)

//go:generate go run github.com/vektra/mockery/v2@v2.42.2 --all
type AdServicer interface {
        GetAdByID(ctx context.Context, id string, includeDescription bool) (*model.Ad, error)
        GetAds(ctx context.Context, page int, sort string, order string) ([]*model.Ad, error)
        CreateAd(ctx context.Context, ad *model.Ad) (string, error)
}

type adService struct {
        repo repository.AdRepository
}

func NewAdService(repo repository.AdRepository) AdServicer <span class="cov0" title="0">{
        return &amp;adService{repo: repo}
}</span>

func (s *adService) GetAdByID(ctx context.Context, id string, includeDescription bool) (*model.Ad, error) <span class="cov0" title="0">{
        return s.repo.GetAdByID(ctx, id, includeDescription)

}</span>

func (s *adService) GetAds(ctx context.Context, page int, sort string, order string) ([]*model.Ad, error) <span class="cov0" title="0">{
        return s.repo.GetAds(ctx, page, sort, order)
}</span>

func (s *adService) CreateAd(ctx context.Context, ad *model.Ad) (string, error) <span class="cov0" title="0">{
        return s.repo.CreateAd(ctx, ad)

}</span>
</pre>
		
		<pre class="file" id="file8" style="display: none">// Code generated by mockery v2.42.2. DO NOT EDIT.

package mocks

import (
        model "advertisement-rest-api-http-service/internal/model"
        context "context"

        mock "github.com/stretchr/testify/mock"
)

// AdServicer is an autogenerated mock type for the AdServicer type
type AdServicer struct {
        mock.Mock
}

// CreateAd provides a mock function with given fields: ctx, ad
func (_m *AdServicer) CreateAd(ctx context.Context, ad *model.Ad) (string, error) <span class="cov0" title="0">{
        ret := _m.Called(ctx, ad)

        if len(ret) == 0 </span><span class="cov0" title="0">{
                panic("no return value specified for CreateAd")</span>
        }

        <span class="cov0" title="0">var r0 string
        var r1 error
        if rf, ok := ret.Get(0).(func(context.Context, *model.Ad) (string, error)); ok </span><span class="cov0" title="0">{
                return rf(ctx, ad)
        }</span>
        <span class="cov0" title="0">if rf, ok := ret.Get(0).(func(context.Context, *model.Ad) string); ok </span><span class="cov0" title="0">{
                r0 = rf(ctx, ad)
        }</span> else<span class="cov0" title="0"> {
                r0 = ret.Get(0).(string)
        }</span>

        <span class="cov0" title="0">if rf, ok := ret.Get(1).(func(context.Context, *model.Ad) error); ok </span><span class="cov0" title="0">{
                r1 = rf(ctx, ad)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// GetAdByID provides a mock function with given fields: ctx, id, includeDescription
func (_m *AdServicer) GetAdByID(ctx context.Context, id string, includeDescription bool) (*model.Ad, error) <span class="cov0" title="0">{
        ret := _m.Called(ctx, id, includeDescription)

        if len(ret) == 0 </span><span class="cov0" title="0">{
                panic("no return value specified for GetAdByID")</span>
        }

        <span class="cov0" title="0">var r0 *model.Ad
        var r1 error
        if rf, ok := ret.Get(0).(func(context.Context, string, bool) (*model.Ad, error)); ok </span><span class="cov0" title="0">{
                return rf(ctx, id, includeDescription)
        }</span>
        <span class="cov0" title="0">if rf, ok := ret.Get(0).(func(context.Context, string, bool) *model.Ad); ok </span><span class="cov0" title="0">{
                r0 = rf(ctx, id, includeDescription)
        }</span> else<span class="cov0" title="0"> {
                if ret.Get(0) != nil </span><span class="cov0" title="0">{
                        r0 = ret.Get(0).(*model.Ad)
                }</span>
        }

        <span class="cov0" title="0">if rf, ok := ret.Get(1).(func(context.Context, string, bool) error); ok </span><span class="cov0" title="0">{
                r1 = rf(ctx, id, includeDescription)
        }</span> else<span class="cov0" title="0"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov0" title="0">return r0, r1</span>
}

// GetAds provides a mock function with given fields: ctx, page, sort, order
func (_m *AdServicer) GetAds(ctx context.Context, page int, sort string, order string) ([]*model.Ad, error) <span class="cov8" title="1">{
        ret := _m.Called(ctx, page, sort, order)

        if len(ret) == 0 </span><span class="cov0" title="0">{
                panic("no return value specified for GetAds")</span>
        }

        <span class="cov8" title="1">var r0 []*model.Ad
        var r1 error
        if rf, ok := ret.Get(0).(func(context.Context, int, string, string) ([]*model.Ad, error)); ok </span><span class="cov0" title="0">{
                return rf(ctx, page, sort, order)
        }</span>
        <span class="cov8" title="1">if rf, ok := ret.Get(0).(func(context.Context, int, string, string) []*model.Ad); ok </span><span class="cov0" title="0">{
                r0 = rf(ctx, page, sort, order)
        }</span> else<span class="cov8" title="1"> {
                if ret.Get(0) != nil </span><span class="cov8" title="1">{
                        r0 = ret.Get(0).([]*model.Ad)
                }</span>
        }

        <span class="cov8" title="1">if rf, ok := ret.Get(1).(func(context.Context, int, string, string) error); ok </span><span class="cov0" title="0">{
                r1 = rf(ctx, page, sort, order)
        }</span> else<span class="cov8" title="1"> {
                r1 = ret.Error(1)
        }</span>

        <span class="cov8" title="1">return r0, r1</span>
}

// NewAdServicer creates a new instance of AdServicer. It also registers a testing interface on the mock and a cleanup function to assert the mocks expectations.
// The first argument is typically a *testing.T value.
func NewAdServicer(t interface {
        mock.TestingT
        Cleanup(func())
}) *AdServicer <span class="cov0" title="0">{
        mock := &amp;AdServicer{}
        mock.Mock.Test(t)

        t.Cleanup(func() </span><span class="cov0" title="0">{ mock.AssertExpectations(t) }</span>)

        <span class="cov0" title="0">return mock</span>
}
</pre>
		
		<pre class="file" id="file9" style="display: none">package database

import (
        "context"

        "cloud.google.com/go/firestore"
        firebase "firebase.google.com/go"
        "google.golang.org/api/option"
)

type DB interface {
        Collection(path string) *firestore.CollectionRef
        Close(ctx context.Context) error
}

type firestoreClientWrapper struct {
        client *firestore.Client
}

func (w *firestoreClientWrapper) Collection(path string) *firestore.CollectionRef <span class="cov0" title="0">{

        return w.client.Collection(path)
}</span>

func InitFirestoreClient(ctx context.Context, credsFilePath string) (DB, error) <span class="cov0" title="0">{
        client, err := initFirestoreClient(ctx, credsFilePath)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">return &amp;firestoreClientWrapper{client: client}, nil</span>
}

func initFirestoreClient(ctx context.Context, credsFilePath string) (*firestore.Client, error) <span class="cov0" title="0">{
        sa := option.WithCredentialsFile(credsFilePath)
        app, err := firebase.NewApp(ctx, nil, sa)
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>

        <span class="cov0" title="0">return app.Firestore(ctx)</span>
}

func (w *firestoreClientWrapper) Close(ctx context.Context) error <span class="cov0" title="0">{
        return w.client.Close()
}</span>
</pre>
		
		<pre class="file" id="file10" style="display: none">package config

import (
        "os"

        nested "github.com/antonfisher/nested-logrus-formatter"
        log "github.com/sirupsen/logrus"
)

func InitLog() <span class="cov0" title="0">{

        log.SetLevel(getLoggerLevel(os.Getenv("LOG_LEVEL")))
        log.SetReportCaller(true)
        log.SetFormatter(&amp;nested.Formatter{
                HideKeys:        true,
                FieldsOrder:     []string{"component", "category"},
                TimestampFormat: "2006-01-02 15:04:05",
                ShowFullLevel:   true,
                CallerFirst:     true,
        })

}</span>

func getLoggerLevel(value string) log.Level <span class="cov0" title="0">{
        switch value </span>{
        case "DEBUG":<span class="cov0" title="0">
                return log.DebugLevel</span>
        case "TRACE":<span class="cov0" title="0">
                return log.TraceLevel</span>
        default:<span class="cov0" title="0">
                return log.InfoLevel</span>
        }
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
